import google.generativeai as genai

# --- API Key ‡∂ë‡∂ö ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ---
# ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂∏‡∑ô‡∂∫ ‡∂Ö‡∂±‡∑ä ‡∂Ö‡∂∫‡∂ß ‡∂¥‡∑ô‡∂±‡∑ô‡∂±‡∑ä‡∂±‡∂ß ‡∂±‡∑ú‡∂≠‡∑ê‡∂∂‡∑ì‡∂∏‡∂ß ‡∑Ä‡∂ú‡∂∂‡∂Ω‡∑è ‡∂ú‡∂±‡∑ä‡∂±.
GOOGLE_API_KEY = "AIzaSyAzqgn6qnQHF28ck_a1uGD6CDSVqZEU28A"
genai.configure(api_key=GOOGLE_API_KEY)

# ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä‡∑ö ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä (Page Config)
st.set_page_config(page_title="Science Master AI", page_icon="üî¨", layout="centered")

# ‡∂¥‡∑ô‡∂±‡∑î‡∂∏ ‡∂Ω‡∑É‡∑ä‡∑É‡∂± ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß CSS
st.markdown("""
    <style>
    .main-title { color: #1e3a8a; text-align: center; font-weight: bold; font-size: 35px; }
    .stButton>button { width: 100%; border-radius: 8px; background-color: #1e3a8a; color: white; height: 50px; font-size: 18px; }
    </style>
    """, unsafe_allow_html=True)

# ‡∂¥‡∑ê‡∂≠‡∑í ‡∂≠‡∑ì‡∂ª‡∑î‡∑Ä (Sidebar)
with st.sidebar:
    st.markdown("<h2 style='text-align: center;'>‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂ö‡∂ª‡∑î</h2>", unsafe_allow_html=True)
    try:
        st.image("https://i.ibb.co/v4mYpYp/rasanga.jpg", use_container_width=True)
    except:
        st.info("‡∂¥‡∑í‡∂±‡∑ä‡∂≠‡∑ñ‡∂ª‡∂∫ ‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∂ö‡∑Ö ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö.")
    st.markdown("<p style='text-align: center; font-weight: bold;'>Rasanga Kalamba Arachchi</p>", unsafe_allow_html=True)
    st.markdown("---")
    st.write("‡∂∏‡∑ô‡∂∏ AI ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫ ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∂ï‡∂±‡∑ë‡∂∏ ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ö‡∑ä ‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂±‡∑í‡∂ª‡∑ä‡∂Ø‡∑ö‡∑Å‡∂∫‡∂ß ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂¥‡∑ê‡∑Ñ‡∑ê‡∂Ø‡∑í‡∂Ω‡∑í ‡∂ö‡∂ª ‡∂Ø‡∑ö.")

# ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂ö‡∑ú‡∂ß‡∑É
st.markdown("<div class='main-title'>üî¨ Science Master AI</div>", unsafe_allow_html=True)
st.write("---")

user_input = st.text_area("‡∂î‡∂∂‡∑ö ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫ ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω‡∑ô‡∂±‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:", height=150, placeholder="‡∂ã‡∂Ø‡∑è: ‡∂Ü‡∂Ω‡∑ù‡∂ö‡∂∫‡∑ö ‡∑Ä‡∂ª‡∑ä‡∂≠‡∂±‡∂∫ ‡∂∫‡∂±‡∑î ‡∂ö‡∑î‡∂∏‡∂ö‡∑ä‡∂Ø?")

if st.button("‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂± ‚ú®"):
    if user_input:
        with st.spinner('‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª ‡∑É‡∂ö‡∑É‡∑ä ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...'):
            try:
                # ‡∂±‡∑Ä‡∂≠‡∂∏ 1.5-flash ‡∂∏‡∑è‡∂Ø‡∑í‡∂Ω‡∑í‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂∏‡∑î
                model = genai.GenerativeModel('gemini-1.5-flash')
                
                # Instruction ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑É‡∂∏‡∂ü ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫ ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∏
                prompt = f"You are a science teacher. Explain the following question in detail using Sinhala language, including key points for exams: {user_input}"
                response = model.generate_content(prompt)
                
                st.markdown("### üí° ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª:")
                st.info(response.text)
                
            except Exception as e:
                # ‡∑Ä‡∑ê‡∂ª‡∑ê‡∂Ø‡∑ä‡∂Ø‡∂ö‡∑ä ‡∂Ü‡∑Ä‡∑ú‡∂≠‡∑ä ‡∂ë‡∂∫ ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß
                if "403" in str(e):
                    st.error("API Key ‡∂ë‡∂ö ‡∂±‡∑ê‡∑Ä‡∂≠‡∂≠‡∑ä ‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∑Ä‡∑ì ‡∂á‡∂≠. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä Key ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂±‡∑ä‡∂±.")
                else:
                    st.error(f"‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∑í‡∂∫: {str(e)}")
    else:
        st.warning("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.")

st.markdown("---")
st.caption("¬© 2026 Science Master AI | Created by Rasanga")
